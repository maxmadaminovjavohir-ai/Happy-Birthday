const greetingText = `–° –¥–Ω—ë–º —Ä–æ–∂–¥–µ–Ω–∏—è —Ç–µ–±—è üéÇ
–Ø –æ—á–µ–Ω—å —Ä–∞–¥, —á—Ç–æ —Ç—ã –µ—Å—Ç—å –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏, –¥–∞–∂–µ –Ω–µ—Å–º–æ—Ç—Ä—è –Ω–∞ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ –º–µ–∂–¥—É –Ω–∞–º–∏.
–¢—ã –¥–µ–ª–∞–µ—à—å –º–æ–∏ –¥–Ω–∏ —è—Ä—á–µ, –∞ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ ‚Äî –ª—É—á—à–µ.
–ñ–µ–ª–∞—é —Ç–µ–±–µ —É–ª—ã–±–æ–∫, —Å–ø–æ–∫–æ–π—Å—Ç–≤–∏—è –≤–Ω—É—Ç—Ä–∏ –∏ —á—Ç–æ–±—ã –≤—Å—ë, —á—Ç–æ —Ç—ã —Ö–æ—á–µ—à—å ‚Äî –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–æ —Å—Ç–∞–Ω–æ–≤–∏–ª–æ—Å—å —Ä–µ–∞–ª—å–Ω–æ—Å—Ç—å—é.
–ò –ø—É—Å—Ç—å —ç—Ç–æ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∞–π—Ç –±—É–¥–µ—Ç –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ–º, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è —Ç–≤–æ–π –¥–µ–Ω—å üôÇ

–ó–Ω–∞–µ—à—å‚Ä¶ –¥–∞–∂–µ —á–µ—Ä–µ–∑ —Ä–∞—Å—Å—Ç–æ—è–Ω–∏–µ —Ç—ã –∫–∞–∫–∏–º-—Ç–æ –æ–±—Ä–∞–∑–æ–º –¥–µ–ª–∞–µ—à—å –º–æ–∏ –¥–Ω–∏ —Ç–µ–ø–ª–µ–µ –∏ —Å–ø–æ–∫–æ–π–Ω–µ–µ.
–ò–Ω–æ–≥–¥–∞ –¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –æ–¥–Ω–æ–≥–æ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Ç–µ–±—è ‚Äî –∏ –Ω–∞—Å—Ç—Ä–æ–µ–Ω–∏–µ —É–∂–µ –¥—Ä—É–≥–æ–µ.

–ú–Ω–µ –ø—Ä–∞–≤–¥–∞ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–∞–∫–∞—è —Ç—ã: —Ç–≤–æ—è —É–ª—ã–±–∫–∞, —Ç–≤–æ–π —Ö–∞—Ä–∞–∫—Ç–µ—Ä, —Ç–≤–æ–∏ –º—ã—Å–ª–∏‚Ä¶
–ò —è —Ä–∞–¥, —á—Ç–æ —Å—Ä–µ–¥–∏ –º–∏–ª–ª–∏–æ–Ω–æ–≤ –ª—é–¥–µ–π –º—ã –æ–¥–Ω–∞–∂–¥—ã –Ω–∞—á–∞–ª–∏ –æ–±—â–∞—Ç—å—Å—è –∏ —Å—Ç–∞–ª–∏ —á–∞—Å—Ç—å—é –∂–∏–∑–Ω–∏ –¥—Ä—É–≥ –¥—Ä—É–≥–∞.

–Ø —Ö–æ—á—É, —á—Ç–æ–±—ã —Ç—ã —á–∞—â–µ —É–ª—ã–±–∞–ª–∞—Å—å, –º–µ–Ω—å—à–µ –ø–µ—Ä–µ–∂–∏–≤–∞–ª–∞ –∏ –≤—Å–µ–≥–¥–∞ –ø–æ–º–Ω–∏–ª–∞, —á—Ç–æ —Ç—ã –æ—á–µ–Ω—å –æ—Å–æ–±–µ–Ω–Ω–∞—è.
–ü—É—Å—Ç—å —ç—Ç–æ—Ç –¥–µ–Ω—å –±—É–¥–µ—Ç –Ω–∞–ø–æ–ª–Ω–µ–Ω —Ç–µ–ø–ª–æ–º, –≤–Ω–∏–º–∞–Ω–∏–µ–º –∏ –º–∞–ª–µ–Ω—å–∫–∏–º–∏ —á—É–¥–µ—Å–∞–º–∏ ‚Äî –ø–æ—Ç–æ–º—É —á—Ç–æ —Ç—ã —ç—Ç–æ–≥–æ –∑–∞—Å–ª—É–∂–∏–≤–∞–µ—à—å.

–ò —ç—Ç–æ—Ç –º–∞–ª–µ–Ω—å–∫–∏–π —Å–∞–π—Ç ‚Äî –ø—Ä–æ—Å—Ç–æ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –æ —Ç–æ–º, —á—Ç–æ —Å–µ–≥–æ–¥–Ω—è —Ç–≤–æ–π –¥–µ–Ω—å‚Ä¶
–∏ –≥–¥–µ-—Ç–æ –¥–∞–ª–µ–∫–æ –µ—Å—Ç—å —á–µ–ª–æ–≤–µ–∫, –∫–æ—Ç–æ—Ä—ã–π –∏—Å–∫—Ä–µ–Ω–Ω–µ —Ä–∞–¥, —á—Ç–æ —Ç—ã –µ—Å—Ç—å ‚ù§Ô∏è`;

document.getElementById('startBtn').addEventListener('click', function () {
    // 1. Launch Fireworks
    launchFireworks();
    launchSideCannons();

    // 2. Wait 3 seconds then transition
    setTimeout(() => {
        transitionToPage2();
    }, 3000);
});

// Initialize hearts on load
createHearts();

function createHearts() {
    const heartsContainer = document.body;
    for (let i = 0; i < 30; i++) { // Reduced count slightly as hearts are bigger
        const heart = document.createElement('div');
        heart.classList.add('heart');
        heart.innerHTML = '‚ù§Ô∏è';
        heart.style.left = Math.random() * 100 + 'vw';
        heart.style.animationDuration = Math.random() * 3 + 2 + 's'; // 2-5s
        heart.style.animationDelay = Math.random() * 2 + 's';
        heartsContainer.appendChild(heart);
    }
}

function transitionToPage2() {
    const page1 = document.getElementById('page1');
    const page2 = document.getElementById('page2');

    // Fade out Page 1
    page1.classList.add('hidden');

    // Wait for fade out to complete (optional, or overlap slightly)
    setTimeout(() => {
        // Fade in Page 2
        page2.classList.remove('hidden');
        page2.classList.add('active');

        // Start Typewriter after a slight delay
        setTimeout(() => {
            typeWriter(greetingText, 'greeting-text', 1); // 50ms per char
        }, 1000);
    }, 1500); // 1.5s matches transition time
}

function typeWriter(text, elementId, speed) {
    let i = 0;
    const element = document.getElementById(elementId);
    element.innerHTML = ""; // Clear existing text

    function type() {
        if (i < text.length) {
            const char = text.charAt(i);

            if (char === '\n') {
                element.innerHTML += '<br>';
            } else {
                element.innerHTML += char;
            }

            i++;
            setTimeout(type, speed);
        } else {
            // Typing finished, show Next button
            const nextBtn = document.getElementById('nextBtn');
            nextBtn.classList.add('visible');
            nextBtn.addEventListener('click', transitionToPage3);
        }
    }

    type();
}

// Page 3 Logic
const reasons = [
    "–¢—ã –∑–∞—Å—Ç–∞–≤–ª—è–µ—à—å –º–µ–Ω—è —É–ª—ã–±–∞—Ç—å—Å—è –¥–∞–∂–µ –≤ –ø–ª–æ—Ö–∏–µ –¥–Ω–∏",
    "–¢–≤–æ—è —É–ª—ã–±–∫–∞",
    "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è —Ç–≤–æ—è —Å–º–µ–ª–æ—Å—Ç—å –∏ —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å",
    "–¢–≤–æ—ë –ø–æ–Ω–∏–º–∞–Ω–∏–µ",
    "–° —Ç–æ–±–æ–π –æ–æ–æ—á–µ–Ω—å –∫–æ–º—Ñ–æ—Ä—Ç–Ω–æ",
    "–¢—ã –≤–¥–æ—Ö–Ω–æ–≤–ª—è–µ—à—å –º–µ–Ω—è —Å—Ç–∞–Ω–æ–≤–∏—Ç—å—Å—è –ª—É—á—à–µ",
    "–¢–≤–æ–π —Å–º–µ—Ö",
    "–ú–Ω–µ –Ω—Ä–∞–≤–∏—Ç—Å—è, –∫–∞–∫ —Ç—ã –∑–∞–±–æ—Ç–∏—à—å—Å—è –æ–±–æ –º–Ω–µ",
    "–•–∞—Ä–∞–∫—Ç–µ—Ä",
    "–¢–≤–æ–∏ –≥–ª–∞–∑–∞",
    "–¢—ã –¥–∞—Ä–∏—à—å —Ç–µ–ø–ª–æ, –¥–∞–∂–µ –∫–æ–≥–¥–∞ –º—ã –¥–∞–ª–µ–∫–æ –¥—Ä—É–≥ –æ—Ç –¥—Ä—É–≥–∞",
    "–¢—ã —É–º–µ–µ—à—å –ø—Ä–µ–≤—Ä–∞—â–∞—Ç—å –æ–±—ã—á–Ω–æ–µ –≤ –æ—Å–æ–±–µ–Ω–Ω–æ–µ",
    "–° —Ç–æ–±–æ–π –∫–∞–∂–¥—ã–π –º–æ–º–µ–Ω—Ç —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–µ–∑–∞–±—ã–≤–∞–µ–º—ã–º",
    "–¢—ã —Å–∞–º–∞—è –∫—Ä–∞—Å–∏–≤–∞—è –∫–∞–∫ –≤–Ω—É—Ç—Ä–∏, —Ç–∞–∫ –∏ —Å–Ω–∞—Ä—É–∂–∏",
    "–¢–≤–æ—è –∫—Ä–∞—Å–æ—Ç–∞",
    "–¢–≤–æ–∏ —Å–ª–æ–≤–∞ –≤—Å–µ–≥–¥–∞ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç –∏ –≤–¥–æ—Ö–Ω–æ–≤–ª—è—é—Ç",
    "–¢—ã —É–º–µ–µ—à—å –±—ã—Ç—å —Å–∏–ª—å–Ω–æ–π –∏ –Ω–µ–∂–Ω–æ–π –æ–¥–Ω–æ–≤—Ä–µ–º–µ–Ω–Ω–æ",
    "–¢–≤–æ—ë –Ω—ã—Ç—å—ë",
    "–¢–≤–æ–π —Å—Ç–∏–ª—å",
    "–¢–≤–æ–∏ –ø—Ä–∏–≤—ã—á–∫–∏",
    "–° —Ç–æ–±–æ–π –ª—é–±–æ–µ –º–æ–ª—á–∞–Ω–∏–µ –ø—Ä–∏—è—Ç–Ω–æ",
    "–¢—ã –º–µ–Ω—è –ª—é–±–∏—à—å",
    "–¢–≤–æ–π –º–∞–ª–µ–Ω—å–∫–∏–π —Ä–æ—Å—Ç",
    "–¢—ã ‚Äî —Å–∞–º—ã–π –æ—Å–æ–±–µ–Ω–Ω—ã–π —á–µ–ª–æ–≤–µ–∫ –≤ –º–æ–µ–π –∂–∏–∑–Ω–∏ ‚ù§Ô∏è"
];

function transitionToPage3() {
    const page2 = document.getElementById('page2');
    const page3 = document.getElementById('page3');

    // Fade out Page 2
    page2.classList.remove('active');
    page2.classList.add('hidden');

    // Wait and Fade in Page 3
    setTimeout(() => {
        page3.classList.remove('hidden');
        page3.classList.add('active');
        generateCards();
    }, 1500);
}

function generateCards() {
    const grid = document.getElementById('reasonsGrid');
    grid.innerHTML = ''; // Clear existing

    // We want exactly 25 items in the grid
    // 24 Reasons + 1 Button
    for (let i = 0; i < 25; i++) {
        if (i < 24) {
            // Render Reason Card
            const reason = reasons[i];
            const card = document.createElement('div');
            card.classList.add('card');

            card.innerHTML = `
                <div class="card-inner">
                    <div class="card-front">
                        –ü—Ä–∏—á–∏–Ω–∞ #${i + 1} ‚ù§Ô∏è
                    </div>
                    <div class="card-back">
                        ${reason}
                    </div>
                </div>
            `;

            card.addEventListener('click', function () {
                if (!this.classList.contains('flipped')) {
                    this.classList.add('flipped');
                    confetti({
                        particleCount: 30,
                        spread: 60,
                        origin: {
                            x: this.getBoundingClientRect().left / window.innerWidth,
                            y: this.getBoundingClientRect().top / window.innerHeight
                        },
                        zIndex: 2000 // Higher than modal
                    });
                }
            });

            grid.appendChild(card);
        } else {
            // Render "Next" Button in the 25th slot
            const nextBtnContainer = document.createElement('div');
            nextBtnContainer.classList.add('card'); // Use card class for layout
            nextBtnContainer.style.background = 'transparent';
            nextBtnContainer.style.boxShadow = 'none';
            nextBtnContainer.style.display = 'flex';
            nextBtnContainer.style.justifyContent = 'center';
            nextBtnContainer.style.alignItems = 'center';
            nextBtnContainer.style.cursor = 'default';

            const nextBtn = document.createElement('button');
            nextBtn.innerText = '–î–∞–ª—å—à–µ';
            nextBtn.id = 'finalNextBtn';
            nextBtn.style.padding = '15px 30px';
            nextBtn.style.fontSize = '1.2rem';
            nextBtn.style.borderRadius = '20px';
            nextBtn.style.background = '#ff6b6b';
            nextBtn.style.color = 'white';
            nextBtn.style.border = 'none';
            nextBtn.style.cursor = 'pointer';
            nextBtn.style.boxShadow = '0 4px 15px rgba(0,0,0,0.2)';
            nextBtn.style.transition = 'transform 0.2s';
            nextBtn.style.width = '100%';
            nextBtn.style.height = '100%'; // Fill the card slot

            nextBtn.onmouseover = () => nextBtn.style.transform = 'scale(1.05)';
            nextBtn.onmouseout = () => nextBtn.style.transform = 'scale(1)';

            nextBtn.addEventListener('click', function () {
                transitionToPage4();
            });

            nextBtnContainer.appendChild(nextBtn);
            grid.appendChild(nextBtnContainer);
        }
    }
}

// Quiz Data
const quizQuestions = [
    {
        question: "–í—ã—á–∏—Å–ª–∏: 12 √ó 8 - 45",
        options: ["51", "49", "55"],
        correct: 0
    },
    {
        question: "–†–µ—à–∏ —É—Ä–∞–≤–Ω–µ–Ω–∏–µ: 3x + 7 = 19",
        options: ["4", "3", "5"],
        correct: 0
    },
    {
        question: "–ù–∞–π–¥–∏ –ø–ª–æ—â–∞–¥—å –ø—Ä—è–º–æ—É–≥–æ–ª—å–Ω–∏–∫–∞ —Å–æ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏ 7 —Å–º –∏ 5 —Å–º",
        options: ["35 —Å–º¬≤", "12 —Å–º¬≤", "30 —Å–º¬≤"],
        correct: 0
    },
    {
        question: "–í—ã—á–∏—Å–ª–∏: 45 √∑ 9 + 6",
        options: ["11", "10", "9"],
        correct: 0
    },
    {
        question: "–ö–∞–∫ –º–µ–Ω—è –∑–æ–≤—É—Ç?",
        options: ["–ê—Ä—Ç–µ–º", "–ê–º–∏–Ω", "–ê–ª–µ–∫—Å–µ–π"],
        correct: 1
    },
    {
        question: "–ö–æ–≥–¥–∞ –º–æ–π –¥–µ–Ω—å —Ä–æ–∂–¥–µ–Ω–∏—è?",
        options: ["7 –∏—é–ª—è", "7 –∏—é–Ω—è", "17 –∏—é–Ω—è"],
        correct: 1
    },
    {
        question: "–ö–∞–∫–∏–µ —É –º–µ–Ω—è –≤–æ–ª–æ—Å—ã?",
        options: ["–ß—ë—Ä–Ω—ã–µ", "–†—ã–∂–∏–µ", "–°–≤–µ—Ç–ª—ã–µ"],
        correct: 0
    },
    {
        question: "–ö–∞–∫–∏–µ —É –º–µ–Ω—è –≥–ª–∞–∑–∞?",
        options: ["–ó–µ–ª—ë–Ω—ã–µ", "–ì–æ–ª—É–±—ã–µ", "–ö–∞—Ä–∏–µ"],
        correct: 2
    },
    {
        question: "–ö–∞–∫–æ–≥–æ —è –≥–æ–¥–∞ —Ä–æ–∂–¥–µ–Ω–∏—è?",
        options: ["2010", "2009", "2008"],
        correct: 1
    },
    {
        question: "–ö–∞–∫ —è —Ç–µ–±—è –∑–æ–≤—É?",
        options: ["–î—Ä—É–∂–æ–∫", "–°–æ–ª–Ω—ã—à–∫–æ, –∑–∞–π–∫–∞", "–ö–æ—Ç–∏–∫"],
        correct: 1
    }
];

let currentQuestion = 0;
let score = 0;

function transitionToPage4() {
    const page3 = document.getElementById('page3');
    const page4 = document.getElementById('page4');

    // Fade out Page 3
    page3.classList.remove('active');
    page3.classList.add('hidden');

    // Wait and Fade in Page 4
    setTimeout(() => {
        page4.classList.remove('hidden');
        page4.classList.add('active');
        // Quiz starts automatically via HTML structure
    }, 1000);
}

// Quiz Functions
function startQuiz(isNo = false) {
    if (isNo) {
        alert("–ù—É –Ω–∞–¥–æ! üòÖ");
    }
    document.getElementById('quizStart').classList.add('hidden');
    document.getElementById('quizQuestion').classList.remove('hidden');
    showQuestion();
}

function showQuestion() {
    const q = quizQuestions[currentQuestion];
    document.getElementById('questionText').innerText = q.question;
    const optionsDiv = document.getElementById('answerOptions');
    optionsDiv.innerHTML = '';
    document.getElementById('feedback').classList.add('hidden');
    document.getElementById('feedback').innerText = '';

    // Create shuffled options (visually) but keep track of correct index
    // Simplified: Just render as is, user said "shuffled" but data has Correct at specific index.
    // Let's shuffle indices to map back.
    let indices = [0, 1, 2];
    indices.sort(() => Math.random() - 0.5);

    indices.forEach(index => {
        const btn = document.createElement('button');
        btn.innerText = q.options[index];
        btn.classList.add('quiz-btn');
        btn.onclick = () => checkAnswer(index, btn);
        optionsDiv.appendChild(btn);
    });
}

function checkAnswer(selectedIndex, btn) {
    const q = quizQuestions[currentQuestion];
    const feedback = document.getElementById('feedback');
    feedback.classList.remove('hidden');

    // Disable all buttons
    const buttons = document.querySelectorAll('#answerOptions .quiz-btn');
    buttons.forEach(b => b.disabled = true);

    if (selectedIndex === q.correct) {
        score++;
        btn.classList.add('correct');
        feedback.innerText = "–ü—Ä–∞–≤–∏–ª—å–Ω–æ! üòÑ";
        feedback.style.color = "#4cd137";
        confetti({
            particleCount: 20,
            spread: 40,
            origin: { y: 0.6 }
        });
    } else {
        btn.classList.add('wrong');
        feedback.innerText = "–ù–µ —Å–æ–≤—Å–µ–º üòÖ, –Ω–æ –≤—Å—ë —Ä–∞–≤–Ω–æ –ª—é–±–ª—é —Ç–µ–±—è ‚ù§Ô∏è";
        feedback.style.color = "#e84118";
    }

    setTimeout(() => {
        currentQuestion++;
        if (currentQuestion < quizQuestions.length) {
            showQuestion();
        } else {
            showResult();
        }
    }, 2000);
}

function showResult() {
    document.getElementById('quizQuestion').classList.add('hidden');
    document.getElementById('quizResult').classList.remove('hidden');

    const percentage = (score / quizQuestions.length) * 100;
    const resultText = document.getElementById('resultText');
    resultText.innerText = `–¢—ã –æ—Ç–≤–µ—Ç–∏–ª–∞ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞ ${score} –∏–∑ ${quizQuestions.length} –≤–æ–ø—Ä–æ—Å–æ–≤ (${percentage}%)`;

    if (percentage >= 70) {
        document.getElementById('resultTitle').innerText = "–ú–æ–ª–æ–¥–µ—Ü! üéâ";
        document.getElementById('surpriseContainer').classList.remove('hidden');
        document.getElementById('surpriseVideo').play();
        launchFireworks();
    } else {
        document.getElementById('resultTitle').innerText = "–ü–æ—á—Ç–∏ –ø–æ–ª—É—á–∏–ª–æ—Å—å! üòâ";
        resultText.innerText += "\n–ü–æ–¥–∞—Ä–æ–∫ –±—É–¥–µ—Ç –≤ —Å–ª–µ–¥—É—é—â–µ–º –≥–æ–¥—É... —à—É—á—É! (–∏–ª–∏ –Ω–µ—Ç?)";
        document.getElementById('restartBtn').classList.remove('hidden');
    }
}

function restartQuiz() {
    currentQuestion = 0;
    score = 0;
    document.getElementById('quizResult').classList.add('hidden');
    document.getElementById('quizStart').classList.remove('hidden');
    document.getElementById('restartBtn').classList.add('hidden');
    document.getElementById('surpriseContainer').classList.add('hidden');
}

function launchSideCannons() {
    var end = Date.now() + (2 * 1000); // 2 seconds

    // go Buckeyes!
    var colors = ['#bb0000', '#ffffff'];

    (function frame() {
        confetti({
            particleCount: 2,
            angle: 60,
            spread: 55,
            origin: { x: 0, y: 0.8 }, // Bottom left
            colors: colors
        });
        confetti({
            particleCount: 2,
            angle: 120,
            spread: 55,
            origin: { x: 1, y: 0.8 }, // Bottom right
            colors: colors
        });

        if (Date.now() < end) {
            requestAnimationFrame(frame);
        }
    }());
}

function launchFireworks() {
    var duration = 5 * 1000;
    var animationEnd = Date.now() + duration;
    var defaults = { startVelocity: 30, spread: 360, ticks: 60, zIndex: 0 };

    function randomInRange(min, max) {
        return Math.random() * (max - min) + min;
    }

    var interval = setInterval(function () {
        var timeLeft = animationEnd - Date.now();

        if (timeLeft <= 0) {
            return clearInterval(interval);
        }

        var particleCount = 50 * (timeLeft / duration);
        // since particles fall, I want to start a bit higher than random
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.1, 0.3), y: Math.random() - 0.2 } }));
        confetti(Object.assign({}, defaults, { particleCount, origin: { x: randomInRange(0.7, 0.9), y: Math.random() - 0.2 } }));
    }, 250);
}
